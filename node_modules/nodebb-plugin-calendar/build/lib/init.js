'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _controllers = require('./controllers');

var _controllers2 = _interopRequireDefault(_controllers);

var _reminders = require('./reminders');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const meta = require.main.require('./src/meta');

const p = _bluebird2.default.promisify;

const getSettings = p(meta.settings.get);
const setSettings = p(meta.settings.set);

exports.default = (_ref, callback) => {
  let router = _ref.router;
  let middleware = _ref.middleware;

  (0, _controllers2.default)(router, middleware);

  const defaults = {
    checkingInterval: 1000 * 60 * 5
  };

  getSettings('plugin-calendar').then(settings => setSettings('plugin-calendar', (0, _extends3.default)({}, defaults, settings))).then(() => (0, _reminders.initNotifierDaemon)()).asCallback(callback);

  // TODO: configuration
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvaW5pdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBRUE7Ozs7QUFLQTs7OztBQUNBOzs7O0FBUkEsTUFBTSxPQUFPLFFBQVEsSUFBUixDQUFhLE9BQWIsQ0FBcUIsWUFBckIsQ0FBYjs7QUFHQSxNQUFNLElBQUksbUJBQVEsU0FBbEI7O0FBRUEsTUFBTSxjQUFjLEVBQUUsS0FBSyxRQUFMLENBQWMsR0FBaEIsQ0FBcEI7QUFDQSxNQUFNLGNBQWMsRUFBRSxLQUFLLFFBQUwsQ0FBYyxHQUFoQixDQUFwQjs7a0JBSWUsT0FBeUIsUUFBekIsS0FBc0M7QUFBQSxNQUFuQyxNQUFtQyxRQUFuQyxNQUFtQztBQUFBLE1BQTNCLFVBQTJCLFFBQTNCLFVBQTJCOztBQUNuRCw2QkFBWSxNQUFaLEVBQW9CLFVBQXBCOztBQUVBLFFBQU0sV0FBVztBQUNmLHNCQUFrQixPQUFPLEVBQVAsR0FBWTtBQURmLEdBQWpCOztBQUlBLGNBQVksaUJBQVosRUFBK0IsSUFBL0IsQ0FBb0MsWUFDbEMsWUFBWSxpQkFBWiw2QkFBb0MsUUFBcEMsRUFBaUQsUUFBakQsRUFERixFQUdDLElBSEQsQ0FHTSxNQUFNLG9DQUhaLEVBSUMsVUFKRCxDQUlZLFFBSlo7OztBQU9ELEMiLCJmaWxlIjoiaW5pdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1ldGEgPSByZXF1aXJlLm1haW4ucmVxdWlyZSgnLi9zcmMvbWV0YScpO1xyXG5cclxuaW1wb3J0IFByb21pc2UgZnJvbSAnYmx1ZWJpcmQnO1xyXG5jb25zdCBwID0gUHJvbWlzZS5wcm9taXNpZnk7XHJcblxyXG5jb25zdCBnZXRTZXR0aW5ncyA9IHAobWV0YS5zZXR0aW5ncy5nZXQpO1xyXG5jb25zdCBzZXRTZXR0aW5ncyA9IHAobWV0YS5zZXR0aW5ncy5zZXQpO1xyXG5pbXBvcnQgY29udHJvbGxlcnMgZnJvbSAnLi9jb250cm9sbGVycyc7XHJcbmltcG9ydCB7IGluaXROb3RpZmllckRhZW1vbiB9IGZyb20gJy4vcmVtaW5kZXJzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0ICh7IHJvdXRlciwgbWlkZGxld2FyZSB9LCBjYWxsYmFjaykgPT4ge1xyXG4gIGNvbnRyb2xsZXJzKHJvdXRlciwgbWlkZGxld2FyZSk7XHJcblxyXG4gIGNvbnN0IGRlZmF1bHRzID0ge1xyXG4gICAgY2hlY2tpbmdJbnRlcnZhbDogMTAwMCAqIDYwICogNSxcclxuICB9O1xyXG5cclxuICBnZXRTZXR0aW5ncygncGx1Z2luLWNhbGVuZGFyJykudGhlbihzZXR0aW5ncyA9PlxyXG4gICAgc2V0U2V0dGluZ3MoJ3BsdWdpbi1jYWxlbmRhcicsIHsgLi4uZGVmYXVsdHMsIC4uLnNldHRpbmdzIH0pXHJcbiAgKVxyXG4gIC50aGVuKCgpID0+IGluaXROb3RpZmllckRhZW1vbigpKVxyXG4gIC5hc0NhbGxiYWNrKGNhbGxiYWNrKTtcclxuXHJcbiAgLy8gVE9ETzogY29uZmlndXJhdGlvblxyXG59O1xyXG4iXX0=